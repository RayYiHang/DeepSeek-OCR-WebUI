# 🔍 Find 模式 v2.0 - 左右分栏版本使用指南

## 🎉 全新设计

**Find 模式现在采用专用的左右分栏布局！**

### 新版特性

- ✅ **独立界面** - 完全独立的 Find 专用页面
- ✅ **左右分栏** - 清晰的操作和结果展示
- ✅ **边界框可视化** - 彩色霓虹标注效果
- ✅ **实时预览** - 立即看到标注结果
- ✅ **匹配项列表** - 详细显示每个找到的位置

---

## 🖥️ 界面布局

```
┌─────────────────────────────────────────────────────┐
│                    模式选择器                         │
├──────────────────┬──────────────────────────────────┤
│   左侧面板 📤     │      右侧面板 ✨                  │
├──────────────────┼──────────────────────────────────┤
│ 🔍 查找定位       │  ✨ 识别结果                      │
│                  │                                  │
│ 📤 上传图片       │  🖼️ 结果图片（带边界框）          │
│ ┌──────────────┐│  ┌──────────────────────────┐   │
│ │  点击或拖拽   ││  │                          │   │
│ │  上传图片     ││  │    标注后的图片           │   │
│ └──────────────┘│  │    + Canvas 边界框        │   │
│                  │  └──────────────────────────┘   │
│ 🎯 查找内容       │                                  │
│ ┌──────────────┐│  📊 统计信息                      │
│ │ Total        ││  ✓ 找到 2 个匹配项                │
│ └──────────────┘│  🎯 查找词: Total                 │
│                  │                                  │
│ 🚀 开始查找       │  📝 识别文本                      │
│ 🔄 更换图片       │  Total: $1,234.56                │
│ 🗑️ 清空重置       │                                  │
│                  │  📦 找到的匹配项                  │
│                  │  ▪ Total [123, 456, 234, 567]   │
│                  │  ▪ Total [890, 234, 987, 345]   │
└──────────────────┴──────────────────────────────────┘
```

---

## 🚀 使用流程

### 步骤 1: 选择 Find 模式

1. 打开 Web UI: http://10.68.2.212:8001
2. 点击 **🔍 查找定位** 模式卡片
3. 界面自动切换到左右分栏布局
4. 批量处理界面自动隐藏

### 步骤 2: 上传图片（左侧面板）

**方式 A - 点击上传**:
```
1. 点击左侧的上传区域
2. 选择一张图片
3. 图片预览立即显示
```

**方式 B - 拖拽上传**:
```
1. 拖拽图片到上传区域
2. 松开鼠标完成上传
3. 图片预览立即显示
```

**上传后**:
- 📁 显示文件名和大小
- 🖼️ 显示图片缩略图
- ✅ 启用操作按钮

### 步骤 3: 输入查找词（左侧面板）

在 "🎯 输入查找内容" 输入框中输入要查找的内容：

**示例查找词**:
```
✓ Total          - 查找总计
✓ Invoice #      - 查找发票号
✓ Date           - 查找日期
✓ 金额            - 查找金额
✓ 姓名            - 查找姓名
✓ Product        - 查找产品名
```

💡 **提示**: 查找词应该与图片中的实际文字一致

### 步骤 4: 开始查找（左侧面板）

1. 点击 **🚀 开始查找** 按钮
2. 按钮变为 "⏳ 处理中..."
3. 等待 3-8 秒（取决于图片大小）

### 步骤 5: 查看结果（右侧面板）

**结果展示包含**:

1. **📸 标注图片** - 主要展示区域
   - 原图显示
   - 彩色边界框标注
   - 霓虹发光效果
   - 标签文字显示

2. **📊 统计信息** - 快速概览
   - ✓ 找到 X 个匹配项
   - 🎯 查找词显示

3. **📝 识别文本** - 完整内容
   - 识别出的所有文字
   - 可复制

4. **📦 匹配项列表** - 详细信息
   - 每个匹配项的标签
   - 坐标位置
   - 对应颜色

---

## 🎨 边界框可视化

### 视觉效果

每个找到的匹配项会以不同颜色标注：

```
🟢 绿色 (#00ff00)  - 匹配项 1
🔵 青色 (#00ffff)  - 匹配项 2
🟣 紫色 (#ff00ff)  - 匹配项 3
🟡 黄色 (#ffff00)  - 匹配项 4
🔴 粉色 (#ff0066)  - 匹配项 5
🟢 翠色 (#00ff99)  - 匹配项 6+
```

### 标注组成

每个边界框包含：

1. **半透明填充** - 高亮匹配区域（透明度 20%）
2. **霓虹边框** - 4px 粗边框 + 发光效果
3. **文字标签** - 匹配的内容文字
4. **坐标信息** - 在匹配项列表中显示

### 响应式设计

- ✅ 边界框随窗口大小自动调整
- ✅ 坐标精确缩放
- ✅ 防抖优化性能（200ms）

---

## 📖 完整示例

### 示例 1: 查找发票总额

**场景**: 从发票中找到 "Total" 金额的位置

```bash
步骤流程:
1. 选择 "🔍 查找定位" 模式
   └─> 界面切换到左右分栏

2. 左侧：上传发票图片
   └─> 显示文件名: invoice_2024.jpg (342 KB)

3. 左侧：输入查找词
   └─> 输入: Total

4. 左侧：点击 "🚀 开始查找"
   └─> 等待处理...

5. 右侧：查看结果
   ├─> 图片显示，Total 被绿色边框标注
   ├─> 统计: ✓ 找到 1 个匹配项
   ├─> 文本: Total: $1,234.56
   └─> 匹配项: Total [123, 456, 234, 567]
```

**预期效果**:
- 🖼️ 图片上"Total"字样被绿色霓虹边框圈出
- 📊 右上角显示找到 1 个匹配项
- 📝 识别文本区域显示完整内容
- 📦 匹配项列表显示具体坐标

### 示例 2: 查找多个日期

**场景**: 在合同中查找所有"Date"字段

```bash
步骤流程:
1. 选择 "🔍 查找定位" 模式

2. 左侧：上传合同图片
   └─> contract_signed.png (1.2 MB)

3. 左侧：输入 "Date"

4. 左侧：点击 "🚀 开始查找"

5. 右侧：查看结果
   ├─> 图片显示，多个 Date 用不同颜色标注
   │   ├─> Effective Date: 🟢 绿色
   │   ├─> Expiry Date: 🔵 青色
   │   └─> Signature Date: 🟣 紫色
   ├─> 统计: ✓ 找到 3 个匹配项
   └─> 匹配项列表显示 3 个坐标
```

**预期效果**:
- 🖼️ 三个"Date"字段分别用绿色、青色、紫色标注
- 📊 显示找到 3 个匹配项
- 📦 列表显示 3 个详细坐标和标签

### 示例 3: 中文查找

**场景**: 在表格中查找"金额"字段

```bash
输入: 金额
结果:
- 表头的"金额"被标注
- 可能有多行"金额"项都被找到
- 每个都有独立的彩色标注
```

---

## 🔄 操作按钮说明

### 左侧面板按钮

#### 🚀 开始查找
- **启用条件**: 已上传图片 + 已输入查找词
- **功能**: 发起 OCR 识别和定位请求
- **状态**: 处理中显示 "⏳ 处理中..."

#### 🔄 更换图片
- **启用条件**: 已上传图片
- **功能**: 重新选择图片（保留查找词）
- **效果**: 清除当前图片和结果

#### 🗑️ 清空重置
- **启用条件**: 已上传图片
- **功能**: 完全清空图片、查找词和结果
- **效果**: 恢复初始状态

### 按钮状态管理

```
初始状态:
├─ 🚀 开始查找: 禁用（灰色）
├─ 🔄 更换图片: 禁用
└─ 🗑️ 清空重置: 禁用

上传图片后:
├─ 🚀 开始查找: 禁用（等待查找词）
├─ 🔄 更换图片: 启用
└─ 🗑️ 清空重置: 启用

输入查找词后:
├─ 🚀 开始查找: 启用（可点击）✓
├─ 🔄 更换图片: 启用
└─ 🗑️ 清空重置: 启用

处理中:
├─ 🚀 开始查找: 禁用（显示进度）
├─ 🔄 更换图片: 禁用
└─ 🗑️ 清空重置: 禁用

完成后:
├─ 🚀 开始查找: 启用（可重新查找）
├─ 🔄 更换图片: 启用
└─ 🗑️ 清空重置: 启用
```

---

## 🆚 与批量模式对比

| 特性 | Find 模式（v2.0） | 批量模式 |
|-----|-----------------|---------|
| **界面布局** | 左右分栏 | 单栏列表 |
| **图片数量** | 单张 | 多张 |
| **上传方式** | 点击/拖拽 | 点击/拖拽 |
| **预览位置** | 左侧缩略图 | 网格卡片 |
| **结果展示** | 右侧大图 + 边界框 | 文本区域 |
| **边界框** | ✅ 可视化 | ❌ 无 |
| **匹配项列表** | ✅ 详细坐标 | ❌ 无 |
| **适用场景** | 精确定位 | 批量提取 |
| **处理速度** | 3-8秒 | 逐一处理 |

---

## 💡 使用技巧

### 提高查找准确度

1. **使用准确的关键词**
   ```
   ✓ 好: Total
   ✗ 差: total amount sum
   ```

2. **匹配图片中的实际文字**
   ```
   图片中显示: "Invoice #"
   ✓ 输入: Invoice #
   ✗ 输入: Invoice Number
   ```

3. **注意大小写**
   ```
   ✓ Total  - 如果图片中是大写
   ✗ total  - 可能找不到
   ```

### 查找不到内容？

**检查清单**:
- [ ] 查找词是否与图片中完全一致
- [ ] 是否有拼写错误
- [ ] 大小写是否匹配
- [ ] 图片是否清晰可读
- [ ] 查找词是否太长或太短

**解决方法**:
1. **简化查找词** - 只输入关键部分
   ```
   图片: "Total Amount: $1,234"
   尝试: Total  （而不是 Total Amount）
   ```

2. **查看识别文本** - 在识别文本区域确认词是否被识别
   ```
   如果识别文本中有，但没找到：
   └─> 可能是 grounding 模型的限制
   ```

3. **尝试同义词**
   ```
   找不到"Amount" → 尝试"Total"
   找不到"Date" → 尝试具体日期格式
   ```

### 最佳实践

**📌 上传前**:
- 确保图片清晰（避免模糊、倾斜）
- 文件大小适中（< 5MB 为佳）
- 格式为标准图片格式

**📌 查找时**:
- 输入简洁明确的关键词
- 一次查找一个词（不要输入多个）
- 查看日志了解处理过程

**📌 结果后**:
- 检查边界框位置是否准确
- 查看匹配项列表确认所有位置
- 需要时可以重新查找

---

## 🔧 技术细节

### 坐标系统

边界框坐标转换流程：

```
1. 模型输出: 归一化坐标 (0-999)
   [x1, y1, x2, y2] = [123, 456, 234, 567]
   
2. 后端转换: 像素坐标
   imageWidth = 1024px, imageHeight = 768px
   pixelX1 = 123 / 999 * 1024 = 126px
   pixelY1 = 456 / 999 * 768 = 351px
   
3. 前端缩放: 显示坐标
   displayWidth = 800px
   scaleX = 800 / 1024 = 0.78
   displayX1 = 126 * 0.78 = 98px
```

### Canvas 绘制

```javascript
// 设置 Canvas 尺寸
canvas.width = img.offsetWidth
canvas.height = img.offsetHeight

// 绘制边界框
ctx.fillStyle = color + '33'  // 半透明填充
ctx.fillRect(x, y, width, height)

ctx.strokeStyle = color
ctx.lineWidth = 4
ctx.shadowBlur = 15  // 霓虹效果
ctx.strokeRect(x, y, width, height)
```

### 性能优化

- ✅ **resize 防抖** - 200ms 延迟避免频繁重绘
- ✅ **Canvas 缓存** - 保存 boxes 数据便于重绘
- ✅ **按钮状态** - 处理中禁用避免重复请求
- ✅ **图片加载** - onload 后再绘制确保尺寸正确

---

## 🐛 故障排查

### 问题 1: 边界框不显示

**症状**: 显示"找到 X 个匹配项"，但图片上没有边界框

**可能原因**:
- Canvas 未正确初始化
- 图片尺寸信息不匹配
- 坐标数据异常

**解决方法**:
1. 打开浏览器控制台（F12）
2. 查看是否有 JavaScript 错误
3. 刷新页面重试
4. 查看日志中的坐标信息

### 问题 2: 边界框位置偏移

**症状**: 边界框显示了，但位置不对

**可能原因**:
- 图片尺寸缩放问题
- 坐标转换错误

**解决方法**:
1. 调整浏览器窗口大小（会自动重绘）
2. 重新上传图片
3. 查看控制台的缩放比例日志

### 问题 3: 按钮一直禁用

**症状**: 上传了图片和输入了查找词，但"开始查找"按钮还是灰色

**解决方法**:
1. 确认图片真的上传成功（看到缩略图）
2. 确认输入框中有文字
3. 刷新页面重试

### 问题 4: 切换模式后界面混乱

**症状**: 从 Find 切换到其他模式，界面显示异常

**解决方法**:
1. 刷新页面
2. 重新选择模式
3. 清空浏览器缓存

---

## 📊 日志说明

### 左侧面板操作日志

```
✓ 图片上传成功
  Find 模式: invoice.jpg
  文件名: invoice.jpg
  大小: 342 KB
  模式: 查找定位

ℹ 开始查找
  查找词: Total
  图片: invoice.jpg
  查找内容: Total
  模式: Find + Grounding

✓ 查找成功
  查找词: Total
  匹配数: 2
  匹配项: Total, Total
```

### 控制台调试日志

```javascript
🎨 绘制边界框: [{label: "Total", box: [123, 456, 234, 567]}]
📏 缩放比例: {scaleX: 0.78, scaleY: 0.75}
📦 Box 0 (Total): [96, 342, 182, 425]
✅ 完成绘制 1 个边界框
```

---

## 🎯 特色功能

### 1. 实时按钮状态管理

按钮根据状态智能启用/禁用：
- 没图片 → 所有按钮禁用
- 有图片无查找词 → "开始查找"禁用
- 处理中 → 所有按钮禁用
- 完成后 → 所有按钮启用

### 2. 匹配项颜色编码

每个匹配项自动分配不同颜色：
- 最多支持 6 种颜色循环
- 边界框和列表颜色对应
- 易于区分不同匹配项

### 3. 坐标信息展示

详细显示每个匹配项的：
- 标签文字
- 像素坐标 [x1, y1, x2, y2]
- 对应颜色方块

### 4. 响应式重绘

窗口大小改变时：
- 自动重新计算缩放比例
- 重绘所有边界框
- 保持坐标精确度

---

## 🚀 快速访问

**Web UI**: http://10.68.2.212:8001

**快速测试**:
```
1. 访问 Web UI
2. 点击 "🔍 查找定位"
3. 上传测试图片
4. 输入 "Total" 或 "金额"
5. 点击 "开始查找"
6. 查看右侧的边界框标注 ✨
```

---

## 📚 相关文档

- [QUICK_START.md](./QUICK_START.md) - 快速开始指南
- [ENHANCED_FEATURES.md](./ENHANCED_FEATURES.md) - 增强功能列表
- [DEPLOYMENT_SUMMARY.md](./DEPLOYMENT_SUMMARY.md) - 部署总结

---

## 🎊 总结

**Find 模式 v2.0 的优势**:

✅ **清晰的布局** - 左右分栏，操作和结果分离  
✅ **即时反馈** - 实时显示处理状态  
✅ **可视化标注** - 彩色边界框一目了然  
✅ **详细信息** - 统计、文本、坐标全面展示  
✅ **易于使用** - 直观的交互设计  
✅ **响应式设计** - 自适应不同屏幕尺寸  

**立即体验新版 Find 模式吧！** 🚀

---

<div align="center">

Made with ❤️ for precision OCR localization

**DeepSeek-OCR-WebUI v3.0**

</div>
