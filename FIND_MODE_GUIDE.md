# 🔍 Find 模式使用指南

## ✨ 功能特色

**Find 模式（查找定位）** 是DeepSeek-OCR-WebUI的全新功能，支持：

- 🎯 **智能查找** - 在图片中查找指定文字
- 📍 **精准定位** - 自动标注找到的位置
- 🎨 **可视化显示** - Canvas 绘制彩色边界框
- 🖼️ **单图专注** - 专为单图精细处理设计

---

## 🚀 快速开始

### 1. 切换到 Find 模式

打开 Web UI 后：
1. 点击模式选择器中的 **🔍 查找定位**
2. UI 会自动切换到单图模式
3. 批量上传区域会被隐藏

### 2. 输入查找词

在 Find 输入框中输入要查找的内容：

**示例查找词**:
- `Total` - 查找总计
- `Invoice #` - 查找发票号
- `Date` - 查找日期
- `金额` - 查找金额
- `姓名` - 查找姓名

💡 **提示**: 查找词区分大小写，建议使用图片中实际出现的文字

### 3. 上传图片

有两种方式上传图片：

**方式 A**: 点击上传区域
- 点击上传区域
- 选择单张图片
- 图片会自动显示预览

**方式 B**: 拖拽上传
- 直接拖拽图片到上传区域
- 松开鼠标即可上传
- 支持快速替换

### 4. 开始查找

1. 点击 **🚀 开始查找** 按钮
2. 系统会自动识别并定位
3. 找到的内容会被彩色边界框标注
4. 识别结果显示在下方

---

## 🎨 边界框可视化

### 效果说明

当找到匹配内容时：

- **彩色边框** - 每个匹配项用不同颜色标注
- **半透明填充** - 高亮显示匹配区域
- **霓虹效果** - 边框带有发光效果
- **标签显示** - 每个框顶部显示匹配的文字

### 颜色方案

```
绿色 (#00ff00)  - 第1个匹配项
青色 (#00ffff)  - 第2个匹配项
紫色 (#ff00ff)  - 第3个匹配项
黄色 (#ffff00)  - 第4个匹配项
粉色 (#ff0066)  - 第5个匹配项
翠色 (#00ff99)  - 第6个匹配项
```

### 自适应缩放

- 边界框会自动适应图片显示尺寸
- 窗口大小改变时自动重新绘制
- 保持坐标精确度

---

## 📖 使用示例

### 示例 1: 查找发票金额

**场景**: 从发票图片中查找总金额

```
步骤:
1. 选择 "🔍 查找定位" 模式
2. 输入查找词: Total
3. 上传发票图片
4. 点击 "开始查找"

预期结果:
✅ 找到 1-2 个匹配项
✅ Total 字样被绿色边框标注
✅ 显示准确的坐标位置
```

### 示例 2: 查找多个日期

**场景**: 在合同中查找所有日期字段

```
步骤:
1. 选择 "🔍 查找定位" 模式
2. 输入查找词: Date
3. 上传合同图片
4. 点击 "开始查找"

预期结果:
✅ 找到多个匹配项（如：Effective Date, Expiry Date）
✅ 每个日期用不同颜色标注
✅ 标签显示具体的匹配文字
```

### 示例 3: 中文查找

**场景**: 在表格中查找"姓名"字段

```
步骤:
1. 选择 "🔍 查找定位" 模式
2. 输入查找词: 姓名
3. 上传表格图片
4. 点击 "开始查找"

预期结果:
✅ 找到表头中的"姓名"
✅ 可能找到多个"姓名"字段
✅ 准确标注每个位置
```

---

## 🔧 技术细节

### 坐标系统

边界框坐标处理流程：

1. **模型输出** - 归一化坐标 (0-999)
2. **后端转换** - 转换为像素坐标
3. **前端缩放** - 适配显示尺寸

```javascript
// 缩放公式
scaleX = displayWidth / originalWidth
scaleY = displayHeight / originalHeight

displayX = originalX * scaleX
displayY = originalY * scaleY
```

### Canvas 绘制

使用 HTML5 Canvas API 实现：

```javascript
// 半透明填充
ctx.fillStyle = color + '33';  // 添加透明度
ctx.fillRect(x, y, width, height);

// 霓虹边框
ctx.strokeStyle = color;
ctx.shadowColor = color;
ctx.shadowBlur = 10;
ctx.strokeRect(x, y, width, height);
```

### 响应式设计

- 图片自适应容器宽度
- Canvas 叠加层同步缩放
- resize 事件自动重绘
- 防抖优化性能

---

## 💡 使用技巧

### 提高查找准确度

1. **使用完整词汇** - 输入完整的单词或短语
2. **注意大小写** - 与图片中的文字保持一致
3. **避免模糊词** - 使用具体的关键词
4. **检查图片质量** - 清晰的图片识别率更高

### 查找不到内容时

✅ **检查查找词拼写**
- 确保没有拼写错误
- 检查大小写

✅ **尝试同义词**
- `Total` → `Sum`, `Amount`
- `Date` → `日期`, `时间`

✅ **查看原始输出**
- 在识别结果中查看完整文本
- 确认目标词是否被正确识别

### 最佳实践

📌 **查找前准备**
- 预览图片确认目标词可见
- 确保图片清晰无遮挡
- 输入精确的查找词

📌 **查找后检查**
- 查看标注位置是否正确
- 检查是否有遗漏的匹配项
- 阅读识别结果文本

---

## 🆚 与批量模式的区别

| 特性 | Find 模式（单图） | 其他模式（批量） |
|-----|--------------|--------------|
| **图片数量** | 单张 | 多张 |
| **处理方式** | 专注定位 | 批量识别 |
| **可视化** | ✅ 边界框标注 | ❌ 仅文本 |
| **适用场景** | 查找定位 | 批量提取 |
| **上传界面** | 单图预览 | 网格布局 |
| **操作按钮** | 开始查找 | 开始识别 |

---

## 🎯 适用场景

### ✅ 适合使用 Find 模式

- 📄 **文档关键字定位** - 在合同、发票中找关键信息
- 📊 **表格字段查找** - 定位表头或特定字段
- 🔢 **数字标注** - 查找金额、编号等
- 📝 **表单填写检查** - 验证必填项是否存在
- 🏷️ **标签识别** - 找产品标签上的特定信息

### ❌ 不适合使用 Find 模式

- 📚 **大量文档批量处理** - 应使用批量模式
- 📖 **完整内容提取** - 应使用 OCR 或文档模式
- 🖼️ **图片描述** - 应使用图像描述模式
- 📊 **图表解析** - 应使用图表解析模式

---

## 🐛 常见问题

### Q1: 边界框不显示？

**可能原因**:
- 查找词不在图片中
- 识别未完成
- Canvas 渲染失败

**解决方法**:
1. 检查日志是否显示"找到 X 个匹配项"
2. 查看识别结果中是否包含查找词
3. 尝试刷新页面重新查找

### Q2: 标注位置不准确？

**可能原因**:
- 图片显示尺寸与原始尺寸差异大
- 坐标转换问题

**解决方法**:
1. 调整浏览器窗口大小（会自动重绘）
2. 重新上传图片
3. 查看日志中的坐标信息

### Q3: 找到了但没标注？

**可能原因**:
- 模型识别到文字但没有返回坐标
- grounding 参数未正确设置

**解决方法**:
1. 查看日志中是否有"找到 X 个边界框"
2. 检查原始输出是否包含 `<|det|>` 标记
3. 尝试重新识别

### Q4: 如何切换回批量模式？

**操作步骤**:
1. 点击其他任意模式（文档、OCR等）
2. 界面自动切换回批量上传区域
3. 可以继续批量处理

---

## 📊 性能说明

### 处理速度

- **单图识别**: 约 3-8 秒
- **边界框绘制**: < 100ms
- **窗口 resize**: < 200ms (防抖)

### 资源占用

- **内存**: 图片预览 + Canvas 叠加层
- **GPU**: 模型推理使用
- **CPU**: Canvas 绘制（轻量）

### 优化措施

- ✅ 防抖处理 resize 事件
- ✅ Canvas 尺寸匹配显示尺寸
- ✅ 坐标计算只在需要时执行
- ✅ 图片预览压缩显示

---

## 🔄 更新日志

### v3.0 (2025-10-22)

🎉 **首次发布 Find 模式**

新增功能:
- ✅ 单图上传预览
- ✅ Canvas 边界框可视化
- ✅ 彩色霓虹标注效果
- ✅ 自适应缩放
- ✅ 响应式重绘
- ✅ 完整日志记录

技术改进:
- 参考 `deepseek_ocr_app` 的实现
- 使用 transformers 引擎（更稳定）
- 优化坐标转换算法
- 防抖处理性能优化

---

## 🎓 进阶用法

### 组合使用

**工作流示例**: 发票处理

```
步骤 1: 使用 Find 模式定位 "Total"
↓
步骤 2: 确认金额位置正确
↓
步骤 3: 切换到"文档转Markdown"模式
↓
步骤 4: 提取完整的发票内容
```

### API 集成

如果需要通过 API 调用：

```bash
curl -X POST https://deepseek-ocr.aws.xin/ocr \
  -F "file=@invoice.jpg" \
  -F "prompt_type=find" \
  -F "find_term=Total" \
  -F "grounding=true"
```

响应格式：

```json
{
  "success": true,
  "text": "Total",
  "raw_text": "<|grounding|><|ref|>Total<|/ref|> <|det|>[123, 456, 234, 567]<|/det|>",
  "boxes": [
    {
      "label": "Total",
      "box": [123, 456, 234, 567]
    }
  ],
  "image_dims": {
    "w": 1024,
    "h": 768
  }
}
```

---

## 📞 支持与反馈

### 遇到问题？

1. **查看日志** - 详细记录在操作日志区域
2. **检查健康状态** - http://10.68.2.212:8001/health
3. **查看文档** - 阅读 [QUICK_START.md](./QUICK_START.md)

### 功能建议？

欢迎提出改进建议：
- 更多标注样式
- 批量 Find 模式
- 导出标注图片
- 坐标信息导出

---

<div align="center">

**享受 Find 模式的强大功能！** 🎉

[返回主页](./README.md) | [快速开始](./QUICK_START.md) | [增强功能](./ENHANCED_FEATURES.md)

</div>
