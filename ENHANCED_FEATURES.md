# 🚀 DeepSeek-OCR-WebUI 增强版功能说明

## 📋 版本信息

**增强版本**: v3.0  
**增强日期**: 2025-10-22  
**基于项目**: 
- DeepSeek-OCR-WebUI (原作者: neosun100)
- deepseek_ocr_app (参考项目: rdumasia303)

---

## ✨ 新增功能

### 1️⃣ **Find 模式 - 智能查找定位** 🔍

**功能描述**：
- 在图片中查找并定位特定的文本内容
- 自动标注找到内容的精确位置（边界框）
- 支持查找多个匹配项

**使用方法**：
1. 选择 "查找定位 (Find)" 模式
2. 在输入框中输入要查找的内容（如：Total、Invoice #、金额等）
3. 上传图片
4. 系统会识别并标注所有匹配项的位置

**应用场景**：
- 📄 在发票中查找 "Total" 金额
- 📝 在合同中查找特定条款
- 📊 在表格中定位关键字段
- 🔖 在文档中查找参考编号

**技术特点**：
- ✅ 支持 grounding boxes（边界框标注）
- ✅ 坐标自动缩放（0-999 归一化 → 实际像素）
- ✅ 支持多个匹配项同时定位
- ✅ 返回精确的位置坐标 [x1, y1, x2, y2]

---

### 2️⃣ **Freeform 模式 - 自定义提示** ✨

**功能描述**：
- 使用自定义提示词进行灵活的图像识别
- 不受预设模式限制，自由定义识别需求
- 支持复杂的多步骤识别任务

**使用方法**：
1. 选择 "自定义 (Freeform)" 模式
2. 在文本框中输入自定义提示词（如：提取所有日期和金额）
3. 上传图片
4. 系统按照您的要求处理图片

**应用场景**：
- 📅 提取所有日期和金额
- 📧 识别并分类不同类型的信息
- 🔢 提取特定格式的数据（如电话号码、邮箱）
- 📝 自定义结构化数据提取

**示例提示词**：
```
1. "提取这张发票中的所有日期、金额和商品名称"
2. "识别图片中的所有人名和职位"
3. "将这个表格转换为 JSON 格式"
4. "提取所有带有单位的数值（如：100kg, 50m）"
5. "识别并翻译图片中的英文文本"
```

---

### 3️⃣ **增强的 Grounding Boxes 支持** 📦

**功能特点**：
- ✅ 自动解析模型返回的边界框信息
- ✅ 坐标归一化处理（从 0-999 到实际像素坐标）
- ✅ 支持单个和多个边界框
- ✅ 提供标签和精确坐标

**数据格式**：
```json
{
  "success": true,
  "text": "识别的文本内容",
  "boxes": [
    {
      "label": "Total",
      "box": [x1, y1, x2, y2]
    }
  ],
  "image_dims": {
    "w": 1920,
    "h": 1080
  }
}
```

---

## 🔄 改进的现有功能

### 1. **后端 API 增强**

**新增 API 参数**：
- `find_term`: 查找词（Find 模式使用）
- `custom_prompt`: 自定义提示（Freeform 模式使用）
- `grounding`: 是否启用边界框标注

**返回数据增强**：
- `raw_text`: 原始模型输出（包含标记）
- `boxes`: 边界框数组
- `image_dims`: 图片尺寸信息
- `metadata`: 元数据信息

### 2. **前端 UI 优化**

**动态输入字段**：
- Find 模式：自动显示查找词输入框
- Freeform 模式：自动显示自定义提示文本框
- 其他模式：隐藏额外输入字段

**用户体验提升**：
- 💡 每个输入框都有使用提示
- 🎨 统一的视觉风格
- ⚡ 流畅的模式切换动画

---

## 🐳 Docker 支持

### **全新 Docker 配置**

**特点**：
- ✅ 基于 NVIDIA PyTorch 官方镜像
- ✅ 完整的 GPU 支持
- ✅ 自动安装 vLLM 和依赖
- ✅ 开放所有 IP 访问（0.0.0.0:8001）
- ✅ 健康检查和自动重启
- ✅ 模型缓存持久化

**快速启动**：
```bash
# 构建并启动
docker compose up -d --build

# 查看日志
docker compose logs -f

# 停止服务
docker compose down
```

**访问地址**：
- Web UI: http://your-ip:8001
- API 文档: http://your-ip:8001/docs
- 健康检查: http://your-ip:8001/health

---

## 🎯 完整功能列表

### 原有功能（保留）
1. ✅ 文档转 Markdown
2. ✅ 通用 OCR
3. ✅ 纯文本提取
4. ✅ 图表解析
5. ✅ 图像描述
6. ✅ 批量处理
7. ✅ 拖拽排序
8. ✅ 详细日志
9. ✅ 进度追踪
10. ✅ 结果复制/下载

### 新增功能
11. ✨ **Find 模式 - 查找定位**
12. ✨ **Freeform 模式 - 自定义提示**
13. ✨ **Grounding Boxes 支持**
14. ✨ **完整 Docker 支持**
15. ✨ **增强的 API 接口**

---

## 📚 使用教程

### Find 模式示例

**场景**：在发票中查找 "Total" 金额

```
1. 选择 "查找定位 (Find)" 模式
2. 输入框输入: Total
3. 上传发票图片
4. 系统返回:
   - 文本: "Total: $1,234.56"
   - 位置: [x1: 450, y1: 320, x2: 680, y2: 360]
```

### Freeform 模式示例

**场景**：从名片中提取结构化信息

```
1. 选择 "自定义 (Freeform)" 模式
2. 提示词输入:
   "提取这张名片中的姓名、职位、公司、电话和邮箱，
    以 JSON 格式返回"
3. 上传名片图片
4. 系统返回结构化的 JSON 数据
```

---

## 🔧 技术实现

### 后端实现
```python
# 核心函数
- clean_grounding_text(): 清理 grounding 标记
- parse_detections(): 解析边界框坐标
- ocr_endpoint(): 增强的 OCR API 接口
```

### 前端实现
```javascript
// 核心功能
- 动态输入字段显示/隐藏
- Find 和 Freeform 参数传递
- 模式切换逻辑增强
```

---

## 📊 性能特点

| 特性 | 说明 |
|-----|-----|
| **GPU 加速** | 使用 vLLM 引擎，性能优异 |
| **批量处理** | 支持一次处理多张图片 |
| **边界框精度** | 像素级精确定位 |
| **响应时间** | 20-60秒/张（取决于图片复杂度） |
| **并发支持** | 单请求顺序处理，保证质量 |

---

## 🎓 最佳实践

### Find 模式
- ✅ 输入准确的查找词
- ✅ 支持英文和中文
- ✅ 可以是数字、符号或短语
- ❌ 避免使用过于通用的词（如 "the"）

### Freeform 模式
- ✅ 提示词要清晰具体
- ✅ 可以包含多个步骤
- ✅ 指定期望的输出格式
- ❌ 避免过于复杂或模糊的要求

---

## 🙏 致谢

**本增强版集成了以下项目的优秀经验**：

1. **DeepSeek-OCR-WebUI** (neosun100)
   - 批量处理架构
   - 现代化 UI 设计
   - 详细日志系统

2. **deepseek_ocr_app** (rdumasia303)
   - Find 和 Freeform 功能设计
   - Grounding boxes 实现
   - React 组件参考

3. **DeepSeek AI 团队**
   - 强大的 OCR 模型
   - Grounding 标注技术

---

## 📞 联系方式

- **原项目**: https://github.com/neosun100/DeepSeek-OCR-WebUI
- **参考项目**: https://github.com/rdumasia303/deepseek_ocr_app
- **模型来源**: https://huggingface.co/deepseek-ai/DeepSeek-OCR

---

## 🎉 总结

增强版 DeepSeek-OCR-WebUI 在保留原有所有功能的基础上，新增了：

1. 🔍 **Find 模式** - 智能查找定位
2. ✨ **Freeform 模式** - 自定义提示
3. 📦 **Grounding Boxes** - 边界框支持
4. 🐳 **完整 Docker 支持** - 一键部署

让 OCR 识别变得更加强大和灵活！🚀

---

## 📱 关注我们

如果觉得有帮助，别忘了点个"在看"并分享给需要的朋友～

<div align="center">

<img src="assets/qrcode_promo.png" alt="关注公众号" width="400">

**扫码关注公众号，获取更多技术分享和项目更新**

</div>
